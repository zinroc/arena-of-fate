module.exports = function (knex, bookshelf) {
    if (!knex && !bookshelf) {
        var db = require("../database.js");
        knex = db.knex;
        bookshelf = db.bookshelf;
    }

    /***************** TABLE DEFINITIONS **********/
    var Player = bookshelf.Model.extend({
        tableName: "players",
    });

    var Fighter = bookshelf.Model.extend({
        tableName: "fighters",
        getTrait: function () {
            var fighter = this;
            return Trait.where("id", fighter.attributes.trait).fetch()
            .then(function (row) {
                fighter.attributes.trait = row;
                return fighter;
            });
        }
    });

    var Trait = bookshelf.Model.extend({
        tableName: "traits",
    });

    var Arena = bookshelf.Model.extend({
        tableName: "arenas"
    });

    var Challenge = bookshelf.Model.extend({
        tableName: "arena_challenges",
        getArena: function () {
            var challenge = this;
            return Arena.where("id", challenge.attributes.arena).fetch()
            .then(function (arena) {
                challenge.attributes.arena = arena;
                return challenge;
            });
        }
    });

    var GameState = bookshelf.Model.extend({
        tableName: "game_state"
    });
    /***************** TABLE DEFINITIONS **********/

    /**************** Module exports **************/
    return {
        Player: Player,
        Fighter: Fighter,
        Challenge: Challenge,
        GameState: GameState,
        Arena: Arena,
    };
    /**************** Module exports **************/
};
